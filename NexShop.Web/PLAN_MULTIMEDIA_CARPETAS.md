# ?? SISTEMA DE CARPETAS Y MULTIMEDIA POR PRODUCTO

## ?? OBJETIVO

Implementar un sistema completo de gestión de multimedia donde:
- ? Cada producto tiene su propia carpeta
- ? Las imágenes y videos se suben en la página de detalles
- ? Se visualizan en galerías responsivas
- ? Las carpetas se crean automáticamente al crear productos
- ? Se aplica a todos los productos existentes

---

## ?? ESTRUCTURA ACTUAL

```
wwwroot/
??? uploads/
?   ??? productos/
?       ??? 1_Power_Bank_3000_mah/
?       ?   ??? imagen_1.jpg
?       ?   ??? imagen_2.png
?       ?   ??? video_1.mp4
?       ??? 2_Cable_USB_C/
?       ?   ??? imagen_1.jpg
?       ?   ??? imagen_2.jpg
?       ??? ... (más carpetas)
```

---

## ?? COMPONENTES A IMPLEMENTAR

### 1. **Actualizar MultimediaService.cs**
```csharp
? Crear carpeta automáticamente al subir archivo
? Guardar en carpeta específica del producto
? Obtener archivos de la carpeta
? Eliminar carpeta al eliminar producto
```

### 2. **Crear MultimediaController.cs**
```csharp
? CargarArchivos (POST) - Subir múltiples archivos
? EliminarArchivo (POST) - Eliminar archivo individual
? ObtenerArchivos (GET) - Traer lista de archivos
? MoverPrincipal (POST) - Establecer imagen principal
```

### 3. **Actualizar ProductosController.cs**
```csharp
? Create: Crear carpeta automáticamente
? DeleteConfirmed: Eliminar carpeta al borrar producto
```

### 4. **Crear/Actualizar Vista: Productos/Details.cshtml**
```html
? Sección de galería de imágenes
? Sección de galería de videos  
? Formulario de carga múltiple
? Buttons para eliminar archivos
? Responsive grid
```

### 5. **Crear Parcial: _MultimediaGallery.cshtml**
```html
? Mostrar imágenes en grid
? Mostrar videos (player)
? Carrusel con controles
? Responsive
```

### 6. **Migración de Datos Existentes**
```powershell
? Script para crear carpetas de productos existentes
? Mover imágenes a sus carpetas
? Actualizar URLs en BD
```

---

## ?? FLUJO DE IMPLEMENTACIÓN

### FASE 1: Backend Services
```
1. Actualizar MultimediaService.cs ?
2. Crear MultimediaController.cs
3. Actualizar ProductosController.cs
```

### FASE 2: Frontend Views
```
1. Actualizar Details.cshtml
2. Crear _MultimediaGallery.cshtml
3. Agregar CSS responsivo
```

### FASE 3: Data Migration
```
1. Crear script PowerShell
2. Ejecutar migración
3. Verificar estructura
```

### FASE 4: Testing
```
1. Subir nuevos archivos
2. Verificar visualización
3. Probar eliminación
```

---

## ?? VISTA DE DETALLES - SECCIÓN MULTIMEDIA

```html
???????????????????????????????????????????????????????
? GALERÍA DE IMÁGENES                                 ?
???????????????????????????????????????????????????????
?                                                     ?
?  ????????????????????????????????                 ?
?  ?    IMAGEN PRINCIPAL (GRANDE) ?                 ?
?  ?                              ?  <-- Imagen principal  ?
?  ?                              ?      (2/2)         ?
?  ????????????????????????????????                 ?
?                                                     ?
?  ????  ????  ????  ????  ????                    ?
?  ????  ????  ????  ????  ????  Thumbnails  ?
?  ????  ????  ????  ????  ????                    ?
?                                                     ?
?  ???????????????????????????????????????????????  ?
?  ? [Subir Imágenes] [Subir Videos]             ?  ?
?  ? Arrastra archivos aquí...                   ?  ?
?  ???????????????????????????????????????????????  ?
?                                                     ?
???????????????????????????????????????????????????????
? GALERÍA DE VIDEOS                                   ?
???????????????????????????????????????????????????????
?  ????  ????  ????  ????                            ?
?  ?? ?  ?? ?  ?? ?  ?? ?  Videos del producto   ?
?  ????  ????  ????  ????                            ?
?                                                     ?
???????????????????????????????????????????????????????
```

---

## ?? ESTRUCTURA DE CARPETAS POR PRODUCTO

```
Producto: "Power Bank 3000 mAh"
ProductoId: 1

Carpeta: /uploads/productos/1_Power_Bank_3000_mAh/

Contenido:
??? img_abc123_20251128.jpg (Principal)
??? img_def456_20251128.png (2da imagen)
??? img_ghi789_20251128.webp
??? vid_jkl012_20251128.mp4
??? vid_mno345_20251128.webm
??? metadata.json (opcional)
```

---

## ?? PROCESOS AUTOMÁTICOS

### Al crear un producto:
```csharp
1. Crear Producto en BD
2. Obtener ProductoId
3. Crear carpeta: /uploads/productos/{ProductoId}_{NombreSanitizado}/
4. Guardar en BD
5. Redirigir a Details para subir multimedia
```

### Al subir archivo:
```csharp
1. Validar archivo (tipo, tamaño)
2. Generar nombre único
3. Guardar en carpeta del producto
4. Crear registro en tabla Multimedia
5. Retornar URL relativa
```

### Al eliminar producto:
```csharp
1. Eliminar registros de Multimedia en BD
2. Eliminar archivos físicos
3. Eliminar carpeta del producto
4. Eliminar producto en BD
```

---

## ? ESTADO ACTUAL

```
? MultimediaService.cs: Existe y funciona
? Modelo Multimedia: Completo con propiedades
??  MultimediaController.cs: NO EXISTE (crear nuevo)
??  Carpetas automáticas: NO IMPLEMENTADO
??  Vista Details mejorada: PARCIAL
??  Galería responsive: NECESITA CSS
```

---

## ?? TAREAS PENDIENTES

- [ ] Crear MultimediaController.cs
- [ ] Actualizar ProductosController.cs (Create/Delete)
- [ ] Actualizar Views/Productos/Details.cshtml
- [ ] Crear _MultimediaGallery.cshtml
- [ ] Crear CSS para galería responsive
- [ ] Script de migración de datos
- [ ] Script de inicialización de carpetas
- [ ] Testing completo

---

**SIGUIENTE: Implementar MultimediaController.cs**
